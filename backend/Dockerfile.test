# Simple test container for Cloud Run debugging
FROM python:3.11-slim

# Set working directory
WORKDIR /app

# Install curl for health checks
RUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*

# Create a simple test server
RUN echo '#!/usr/bin/env python3\n\
import os\n\
import http.server\n\
import socketserver\n\
\n\
port = int(os.environ.get("PORT", 8080))\n\
print(f"Starting server on port {port}")\n\
\n\
class MyHandler(http.server.SimpleHTTPRequestHandler):\n\
    def do_GET(self):\n\
        if self.path == "/health":\n\
            self.send_response(200)\n\
            self.send_header("Content-type", "text/plain")\n\
            self.end_headers()\n\
            self.wfile.write(b"OK")\n\
        else:\n\
            self.send_response(200)\n\
            self.send_header("Content-type", "text/plain")\n\
            self.end_headers()\n\
            self.wfile.write(f"Hello from Cloud Run! Port: {port}".encode())\n\
\n\
with socketserver.TCPServer(("", port), MyHandler) as httpd:\n\
    print(f"Server running on port {port}")\n\
    httpd.serve_forever()' > server.py

# Expose port
EXPOSE 8080

# Run the test server
CMD ["python3", "server.py"]
