# æŠ•ç¨¿ã®ä¿å­˜ãƒ»ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯æ©Ÿèƒ½ è©³ç´°ä»•æ§˜

**ä½œæˆæ—¥**: 2025-11-27  
**æ©Ÿèƒ½å**: Saved Posts / Bookmark Feature  
**å„ªå…ˆåº¦**: æœ€é«˜

---

## ğŸ“‹ æ¦‚è¦

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒèˆˆå‘³ã®ã‚ã‚‹æŠ•ç¨¿ã‚’ä¿å­˜ã—ã€å¾Œã§ç°¡å˜ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹æ©Ÿèƒ½ã§ã™ã€‚SNSã§ã‚ˆãè¦‹ã‚‰ã‚Œã‚‹ã€Œå¾Œã§èª­ã‚€ã€æ©Ÿèƒ½ã«ç›¸å½“ã—ã¾ã™ã€‚

---

## ğŸ¯ æ©Ÿèƒ½è¦ä»¶

### 1. ã‚³ã‚¢æ©Ÿèƒ½

#### 1.1 æŠ•ç¨¿ã®ä¿å­˜/è§£é™¤
- **ä¿å­˜**: æŠ•ç¨¿ã‚«ãƒ¼ãƒ‰ã«ä¿å­˜ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¿½åŠ ã—ã€ã‚¯ãƒªãƒƒã‚¯ã§ä¿å­˜
- **è§£é™¤**: ä¿å­˜æ¸ˆã¿ã®æŠ•ç¨¿ã‹ã‚‰ä¿å­˜ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã§è§£é™¤
- **çŠ¶æ…‹è¡¨ç¤º**: ä¿å­˜æ¸ˆã¿ã‹ã©ã†ã‹ã‚’è¦–è¦šçš„ã«è¡¨ç¤ºï¼ˆã‚¢ã‚¤ã‚³ãƒ³ã®å¡—ã‚Šã¤ã¶ã—ã€è‰²ã®å¤‰æ›´ï¼‰
- **ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—**: ãƒ›ãƒãƒ¼æ™‚ã«ã€Œä¿å­˜ã€/ã€Œä¿å­˜è§£é™¤ã€ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ç¤º
- **å³åº§ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯**: ä¿å­˜/è§£é™¤æ™‚ã«ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ã‚’è¡¨ç¤º

#### 1.2 ä¿å­˜ã—ãŸæŠ•ç¨¿ä¸€è¦§ãƒšãƒ¼ã‚¸
- **ãƒšãƒ¼ã‚¸URL**: `/saved-posts` ã¾ãŸã¯ `/posts/saved`
- **ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«**: ã€Œä¿å­˜ã—ãŸæŠ•ç¨¿ã€/ "Saved Posts"
- **è¡¨ç¤ºå†…å®¹**:
  - ä¿å­˜ã—ãŸæŠ•ç¨¿ã®ãƒªã‚¹ãƒˆï¼ˆPostCardã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨ï¼‰
  - ä¿å­˜æ—¥æ™‚ã®è¡¨ç¤º
  - æŠ•ç¨¿ã®å…¬é–‹ç¯„å›²ã«å¿œã˜ãŸè¡¨ç¤ºåˆ¶å¾¡
- **ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³**: ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼ˆ20ä»¶ãšã¤èª­ã¿è¾¼ã¿ï¼‰

#### 1.3 æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½
- **æ¤œç´¢**: ä¿å­˜ã—ãŸæŠ•ç¨¿ã®å†…å®¹ã§æ¤œç´¢ï¼ˆå°†æ¥å®Ÿè£…ï¼‰
- **ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**:
  - ä¿å­˜æ—¥æ™‚ã§ã‚½ãƒ¼ãƒˆï¼ˆæ–°ã—ã„é †/å¤ã„é †ï¼‰
  - æŠ•ç¨¿æ—¥æ™‚ã§ã‚½ãƒ¼ãƒˆï¼ˆæ–°ã—ã„é †/å¤ã„é †ï¼‰
  - æŠ•ç¨¿è€…ã§ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆå°†æ¥å®Ÿè£…ï¼‰

#### 1.4 é€šçŸ¥æ©Ÿèƒ½ï¼ˆå°†æ¥å®Ÿè£…ï¼‰
- ä¿å­˜ã—ãŸæŠ•ç¨¿ãŒæ›´æ–°ã•ã‚ŒãŸå ´åˆã®é€šçŸ¥
- ä¿å­˜ã—ãŸæŠ•ç¨¿ã«æ–°ã—ã„ã‚³ãƒ¡ãƒ³ãƒˆãŒè¿½åŠ ã•ã‚ŒãŸå ´åˆã®é€šçŸ¥

---

## ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### ãƒ†ãƒ¼ãƒ–ãƒ«: `saved_posts`

```sql
CREATE TABLE saved_posts (
    -- ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    -- å¤–éƒ¨ã‚­ãƒ¼
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    post_id UUID NOT NULL REFERENCES posts(id) ON DELETE CASCADE,
    
    -- ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    
    -- åˆ¶ç´„
    UNIQUE(user_id, post_id)
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_saved_posts_user_id ON saved_posts(user_id);
CREATE INDEX idx_saved_posts_user_created_at ON saved_posts(user_id, created_at DESC);
CREATE INDEX idx_saved_posts_post_id ON saved_posts(post_id);
```

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®èª¬æ˜**:
- `idx_saved_posts_user_id`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®ä¿å­˜ä¸€è¦§å–å¾—ã‚’é«˜é€ŸåŒ–
- `idx_saved_posts_user_created_at`: ä¿å­˜æ—¥æ™‚é †ã®ã‚½ãƒ¼ãƒˆã‚’é«˜é€ŸåŒ–
- `idx_saved_posts_post_id`: æŠ•ç¨¿ãŒå‰Šé™¤ã•ã‚ŒãŸéš›ã®æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ç”¨

### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«

**ãƒ•ã‚¡ã‚¤ãƒ«å**: `backend/alembic/versions/add_saved_posts_table_YYYYMMDD.py`

```python
"""add saved_posts table

Revision ID: add_saved_posts_table_YYYYMMDD
Revises: <previous_revision>
Create Date: YYYY-MM-DD HH:MM:SS.XXXXXX

"""
from typing import Sequence, Union
from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers
revision: str = 'add_saved_posts_table_YYYYMMDD'
down_revision: Union[str, None] = '<previous_revision>'
branch_labels: Union[Sequence[str], None] = None
depends_on: Union[Sequence[str], None] = None


def upgrade() -> None:
    # Create saved_posts table
    op.create_table(
        'saved_posts',
        sa.Column('id', postgresql.UUID(as_uuid=True), primary_key=True, server_default=sa.text('gen_random_uuid()')),
        sa.Column('user_id', postgresql.UUID(as_uuid=True), nullable=False),
        sa.Column('post_id', postgresql.UUID(as_uuid=True), nullable=False),
        sa.Column('created_at', sa.DateTime(timezone=True), nullable=False, server_default=sa.text('CURRENT_TIMESTAMP')),
        sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
        sa.ForeignKeyConstraint(['post_id'], ['posts.id'], ondelete='CASCADE'),
        sa.UniqueConstraint('user_id', 'post_id', name='uq_saved_posts_user_post')
    )
    
    # Create indexes
    op.create_index('idx_saved_posts_user_id', 'saved_posts', ['user_id'])
    op.create_index('idx_saved_posts_user_created_at', 'saved_posts', ['user_id', sa.text('created_at DESC')])
    op.create_index('idx_saved_posts_post_id', 'saved_posts', ['post_id'])


def downgrade() -> None:
    # Drop indexes
    op.drop_index('idx_saved_posts_post_id', table_name='saved_posts')
    op.drop_index('idx_saved_posts_user_created_at', table_name='saved_posts')
    op.drop_index('idx_saved_posts_user_id', table_name='saved_posts')
    
    # Drop table
    op.drop_table('saved_posts')
```

---

## ğŸ”§ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…

### 1. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

**ãƒ•ã‚¡ã‚¤ãƒ«**: `backend/app/models/post.py`

```python
class SavedPost(Base):
    """
    Saved post model.
    
    Tracks which posts users have saved for later reading.
    """
    
    __tablename__ = "saved_posts"
    
    id = Column(PostgreSQLUUID(as_uuid=True), primary_key=True, default=uuid4)
    user_id = Column(
        PostgreSQLUUID(as_uuid=True),
        ForeignKey("users.id", ondelete="CASCADE"),
        nullable=False,
        index=True,
    )
    post_id = Column(
        PostgreSQLUUID(as_uuid=True),
        ForeignKey("posts.id", ondelete="CASCADE"),
        nullable=False,
        index=True,
    )
    created_at = Column(DateTime(timezone=True), nullable=False, default=datetime.utcnow)
    
    # Relationships
    user = relationship("User", back_populates="saved_posts")
    post = relationship("Post", back_populates="saved_by_users")
    
    __table_args__ = (
        UniqueConstraint('user_id', 'post_id', name='uq_saved_posts_user_post'),
    )
```

**Userãƒ¢ãƒ‡ãƒ«ã¸ã®è¿½åŠ **:
```python
saved_posts = relationship("SavedPost", back_populates="user", cascade="all, delete-orphan")
```

**Postãƒ¢ãƒ‡ãƒ«ã¸ã®è¿½åŠ **:
```python
saved_by_users = relationship("SavedPost", back_populates="post", cascade="all, delete-orphan")
```

### 2. ã‚¹ã‚­ãƒ¼ãƒ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `backend/app/schemas/post.py`

```python
class SavedPostCreate(BaseModel):
    """Schema for creating a saved post."""
    post_id: UUID


class SavedPostResponse(BaseModel):
    """Schema for saved post response."""
    id: UUID
    user_id: UUID
    post_id: UUID
    created_at: datetime
    post: Optional[PostResponse] = None  # Include post details if needed
    
    class Config:
        from_attributes = True


class SavedPostListResponse(BaseModel):
    """Schema for saved posts list response."""
    items: List[PostResponse]  # Use PostResponse to include full post details
    total: int
    skip: int
    limit: int
```

### 3. ã‚µãƒ¼ãƒ“ã‚¹å±¤

**ãƒ•ã‚¡ã‚¤ãƒ«**: `backend/app/services/post_service.py`

```python
class SavedPostService:
    """Service for saved post operations."""
    
    @staticmethod
    def save_post(db: Session, user_id: UUID, post_id: UUID) -> SavedPost:
        """
        Save a post for a user.
        
        Args:
            db: Database session
            user_id: User ID
            post_id: Post ID to save
            
        Returns:
            SavedPost instance
            
        Raises:
            ValueError: If post doesn't exist or is already saved
        """
        # Check if post exists and is active
        post = db.query(Post).filter(
            Post.id == post_id,
            Post.is_active == True
        ).first()
        
        if not post:
            raise ValueError("Post not found or inactive")
        
        # Check if already saved
        existing = db.query(SavedPost).filter(
            SavedPost.user_id == user_id,
            SavedPost.post_id == post_id
        ).first()
        
        if existing:
            raise ValueError("Post already saved")
        
        # Create saved post
        saved_post = SavedPost(
            user_id=user_id,
            post_id=post_id
        )
        db.add(saved_post)
        db.commit()
        db.refresh(saved_post)
        
        return saved_post
    
    @staticmethod
    def unsave_post(db: Session, user_id: UUID, post_id: UUID) -> bool:
        """
        Unsave a post for a user.
        
        Args:
            db: Database session
            user_id: User ID
            post_id: Post ID to unsave
            
        Returns:
            True if unsaved, False if not found
        """
        saved_post = db.query(SavedPost).filter(
            SavedPost.user_id == user_id,
            SavedPost.post_id == post_id
        ).first()
        
        if not saved_post:
            return False
        
        db.delete(saved_post)
        db.commit()
        return True
    
    @staticmethod
    def get_saved_posts(
        db: Session,
        user_id: UUID,
        current_user_id: Optional[UUID] = None,
        skip: int = 0,
        limit: int = 20,
        sort_by: str = "created_at",  # "created_at" or "post_created_at"
        sort_order: str = "desc"  # "asc" or "desc"
    ) -> Tuple[List[Post], int]:
        """
        Get saved posts for a user.
        
        Args:
            db: Database session
            user_id: User ID to get saved posts for
            current_user_id: Current user ID (for visibility checks)
            skip: Number of posts to skip
            limit: Maximum number of posts to return
            sort_by: Sort by "created_at" (save date) or "post_created_at" (post date)
            sort_order: Sort order "asc" or "desc"
            
        Returns:
            Tuple of (list of posts, total count)
        """
        # Base query
        query = (
            db.query(SavedPost)
            .filter(SavedPost.user_id == user_id)
            .join(Post, SavedPost.post_id == Post.id)
            .filter(Post.is_active == True)
        )
        
        # Get total count
        total = query.count()
        
        # Apply sorting
        if sort_by == "created_at":
            order_column = SavedPost.created_at
        else:  # sort_by == "post_created_at"
            order_column = Post.created_at
        
        if sort_order == "desc":
            query = query.order_by(order_column.desc())
        else:
            query = query.order_by(order_column.asc())
        
        # Apply pagination
        saved_posts = query.offset(skip).limit(limit).all()
        
        # Get post IDs
        post_ids = [sp.post_id for sp in saved_posts]
        
        # Fetch posts with relationships
        posts = (
            db.query(Post)
            .options(
                joinedload(Post.user),
                joinedload(Post.likes).joinedload(PostLike.user),
                joinedload(Post.comments).joinedload(PostComment.user),
                joinedload(Post.images),
            )
            .filter(Post.id.in_(post_ids))
            .all()
        )
        
        # Sort posts to match saved_posts order
        post_dict = {post.id: post for post in posts}
        ordered_posts = [post_dict[post_id] for post_id in post_ids if post_id in post_dict]
        
        # Filter by visibility (same logic as get_feed)
        visible_posts = []
        for post in ordered_posts:
            if post.visibility == "private" and post.user_id != current_user_id:
                continue
            if post.visibility == "followers_only":
                if current_user_id is None:
                    continue
                if post.user_id != current_user_id:
                    from app.services.follow_service import FollowService
                    if not FollowService.is_following(db, current_user_id, post.user_id):
                        continue
            visible_posts.append(post)
        
        return visible_posts, total
    
    @staticmethod
    def is_post_saved(db: Session, user_id: UUID, post_id: UUID) -> bool:
        """
        Check if a post is saved by a user.
        
        Args:
            db: Database session
            user_id: User ID
            post_id: Post ID
            
        Returns:
            True if saved, False otherwise
        """
        saved_post = db.query(SavedPost).filter(
            SavedPost.user_id == user_id,
            SavedPost.post_id == post_id
        ).first()
        
        return saved_post is not None
    
    @staticmethod
    def get_saved_post_ids(
        db: Session,
        user_id: UUID,
        post_ids: List[UUID]
    ) -> List[UUID]:
        """
        Get list of post IDs that are saved by the user.
        
        Args:
            db: Database session
            user_id: User ID
            post_ids: List of post IDs to check
            
        Returns:
            List of post IDs that are saved
        """
        saved_posts = (
            db.query(SavedPost.post_id)
            .filter(
                SavedPost.user_id == user_id,
                SavedPost.post_id.in_(post_ids)
            )
            .all()
        )
        
        return [sp.post_id for sp in saved_posts]
```

### 4. APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `backend/app/api/posts.py`

```python
@router.post(
    "/{post_id}/save",
    status_code=status.HTTP_201_CREATED,
    summary="Save a post",
)
async def save_post(
    post_id: UUID,
    db: Session = Depends(get_db),
    current_user: dict = Depends(get_current_user),
):
    """
    Save a post for later reading.
    
    Requires authentication.
    """
    user_id = get_user_id_from_token(db, current_user)
    
    try:
        saved_post = SavedPostService.save_post(db, user_id, post_id)
        return {"message": "Post saved successfully", "id": saved_post.id}
    except ValueError as e:
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail=str(e)
        )


@router.delete(
    "/{post_id}/save",
    status_code=status.HTTP_200_OK,
    summary="Unsave a post",
)
async def unsave_post(
    post_id: UUID,
    db: Session = Depends(get_db),
    current_user: dict = Depends(get_current_user),
):
    """
    Unsave a post.
    
    Requires authentication.
    """
    user_id = get_user_id_from_token(db, current_user)
    
    success = SavedPostService.unsave_post(db, user_id, post_id)
    
    if not success:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail="Saved post not found"
        )
    
    return {"message": "Post unsaved successfully"}


@router.get(
    "/saved",
    response_model=List[PostResponse],
    summary="Get saved posts",
)
async def get_saved_posts(
    skip: int = Query(0, ge=0, description="Number of posts to skip"),
    limit: int = Query(20, ge=1, le=100, description="Maximum number of posts to return"),
    sort_by: str = Query(
        "created_at",
        regex="^(created_at|post_created_at)$",
        description="Sort by save date or post date"
    ),
    sort_order: str = Query(
        "desc",
        regex="^(asc|desc)$",
        description="Sort order"
    ),
    db: Session = Depends(get_db),
    current_user: dict = Depends(get_current_user),
):
    """
    Get saved posts for the current user.
    
    Requires authentication.
    Posts are filtered by visibility settings.
    """
    user_id = get_user_id_from_token(db, current_user)
    
    posts, total = SavedPostService.get_saved_posts(
        db,
        user_id,
        current_user_id=user_id,
        skip=skip,
        limit=limit,
        sort_by=sort_by,
        sort_order=sort_order
    )
    
    # Build response
    responses = []
    for post in posts:
        responses.append(_build_post_response(db, post, user_id))
    
    return responses


@router.get(
    "/saved/check",
    summary="Check if posts are saved",
)
async def check_saved_posts(
    post_ids: List[UUID] = Query(..., description="List of post IDs to check"),
    db: Session = Depends(get_db),
    current_user: dict = Depends(get_current_user),
):
    """
    Check which posts are saved by the current user.
    
    Requires authentication.
    Returns a list of post IDs that are saved.
    """
    user_id = get_user_id_from_token(db, current_user)
    
    saved_post_ids = SavedPostService.get_saved_post_ids(db, user_id, post_ids)
    
    return {"saved_post_ids": saved_post_ids}
```

---

## ğŸ¨ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…

### UIãƒ‡ã‚¶ã‚¤ãƒ³

ä¿å­˜ã‚¢ã‚¤ã‚³ãƒ³ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè£…ã—ã¾ã™ï¼š
- **ä½ç½®**: ã‚³ãƒ¡ãƒ³ãƒˆãƒœã‚¿ãƒ³ã¨ã‚·ã‚§ã‚¢ãƒœã‚¿ãƒ³ã®é–“
- **ã‚¢ã‚¤ã‚³ãƒ³**: ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆæœªä¿å­˜ã¯æ ç·šã€ä¿å­˜æ¸ˆã¿ã¯å¡—ã‚Šã¤ã¶ã—ï¼‰
- **è‰²**: 
  - æœªä¿å­˜: ã‚°ãƒ¬ãƒ¼ï¼ˆ`text-gray-500 dark:text-gray-400`ï¼‰
  - ä¿å­˜æ¸ˆã¿: é»„è‰²ç³»ï¼ˆ`text-yellow-600 dark:text-yellow-400`ï¼‰
- **ãƒ›ãƒãƒ¼åŠ¹æœ**: è‰²ãŒæ¿ƒããªã‚‹ï¼ˆ`hover:text-yellow-600 dark:hover:text-yellow-400`ï¼‰
- **ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—**: `title`å±æ€§ã§ã€Œä¿å­˜ã€/ã€Œä¿å­˜è§£é™¤ã€ã‚’è¡¨ç¤º
- **ã‚µã‚¤ã‚º**: ä»–ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã¨åŒã˜ã‚µã‚¤ã‚ºï¼ˆ`w-5 h-5`ï¼‰

### 1. APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/lib/api/posts.ts`

```typescript
/**
 * Save a post
 */
export async function savePost(
  postId: string,
  token: string
): Promise<void> {
  await apiClient.post(
    `/posts/${postId}/save`,
    {},
    {
      headers: {
        Authorization: `Bearer ${token}`,
      },
    }
  );
}

/**
 * Unsave a post
 */
export async function unsavePost(
  postId: string,
  token: string
): Promise<void> {
  await apiClient.delete(`/posts/${postId}/save`, {
    headers: {
      Authorization: `Bearer ${token}`,
    },
  });
}

/**
 * Get saved posts
 */
export async function getSavedPosts(
  skip: number = 0,
  limit: number = 20,
  sortBy: 'created_at' | 'post_created_at' = 'created_at',
  sortOrder: 'asc' | 'desc' = 'desc',
  token: string
): Promise<Post[]> {
  const response = await apiClient.get<Post[]>(`/posts/saved`, {
    params: {
      skip,
      limit,
      sort_by: sortBy,
      sort_order: sortOrder,
    },
    headers: {
      Authorization: `Bearer ${token}`,
    },
  });
  return response.data;
}

/**
 * Check if posts are saved
 */
export async function checkSavedPosts(
  postIds: string[],
  token: string
): Promise<string[]> {
  const response = await apiClient.get<{ saved_post_ids: string[] }>(
    `/posts/saved/check`,
    {
      params: {
        post_ids: postIds.join(','),
      },
      headers: {
        Authorization: `Bearer ${token}`,
      },
    }
  );
  return response.data.saved_post_ids;
}
```

### 2. PostCardã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ‹¡å¼µ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/components/PostCard.tsx`

```typescript
// è¿½åŠ ã™ã‚‹ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
import { savePost, unsavePost } from '@/lib/api/posts';

// è¿½åŠ ã™ã‚‹çŠ¶æ…‹
const [isSaved, setIsSaved] = useState(false);
const [isSaving, setIsSaving] = useState(false);

// è¿½åŠ ã™ã‚‹é–¢æ•°
const handleSaveToggle = async () => {
  if (!isAuthenticated || !user) {
    toast.error(t('errors.authenticationRequired'));
    return;
  }

  setIsSaving(true);
  try {
    const token = await getAccessTokenSilently();
    
    if (isSaved) {
      await unsavePost(post.id, token);
      setIsSaved(false);
      toast.success(t('savedPosts.unsaved'));
    } else {
      await savePost(post.id, token);
      setIsSaved(true);
      toast.success(t('savedPosts.saved'));
    }
  } catch (error) {
    debugLog.error('Failed to toggle save:', error);
    toast.error(t('savedPosts.saveFailed'));
  } finally {
    setIsSaving(false);
  }
};

// UIã«è¿½åŠ ã™ã‚‹ä¿å­˜ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆãƒœã‚¿ãƒ³ã¨ã‚·ã‚§ã‚¢ãƒœã‚¿ãƒ³ã®é–“ï¼‰
<button
  onClick={handleSaveToggle}
  disabled={isSaving}
  className={`transition-colors ${
    isSaved
      ? 'text-yellow-600 dark:text-yellow-400 hover:text-yellow-700 dark:hover:text-yellow-300'
      : 'text-gray-500 dark:text-gray-400 hover:text-yellow-600 dark:hover:text-yellow-400'
  } ${isSaving ? 'opacity-50 cursor-not-allowed' : ''}`}
  title={isSaved ? t('savedPosts.unsave') : t('savedPosts.save')}
  aria-label={isSaved ? t('savedPosts.unsave') : t('savedPosts.save')}
>
  <svg
    className={`w-5 h-5 ${isSaved ? 'fill-current' : ''}`}
    fill={isSaved ? 'currentColor' : 'none'}
    stroke="currentColor"
    viewBox="0 0 24 24"
  >
    <path
      strokeLinecap="round"
      strokeLinejoin="round"
      strokeWidth={2}
      d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"
    />
  </svg>
</button>
```

**åˆæœŸçŠ¶æ…‹ã®è¨­å®š**:
- æŠ•ç¨¿ä¸€è¦§ã‚’å–å¾—ã™ã‚‹éš›ã«ã€ä¿å­˜çŠ¶æ…‹ã‚‚ä¸€ç·’ã«å–å¾—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
- `getFeed`ã‚„`getSavedPosts`ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«`is_saved`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã‹ã€åˆ¥é€”`checkSavedPosts`ã‚’å‘¼ã³å‡ºã™

### 3. ä¿å­˜ã—ãŸæŠ•ç¨¿ä¸€è¦§ãƒšãƒ¼ã‚¸

**ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/app/[locale]/posts/saved/page.tsx`

```typescript
'use client';

import { useState } from 'react';
import { useTranslations } from 'next-intl';
import { useAuth0 } from '@auth0/auth0-react';
import PostCard from '@/components/PostCard';
import Header from '@/components/Header';
import { useDataLoader } from '@/lib/hooks/useDataLoader';
import { getSavedPosts, type Post } from '@/lib/api/posts';
import { ErrorDisplay } from '@/components/ErrorDisplay';
import { extractErrorInfo } from '@/lib/utils/errorHandler';

export default function SavedPostsPage() {
  const { isAuthenticated, getAccessTokenSilently } = useAuth0();
  const t = useTranslations('savedPosts');
  const [sortBy, setSortBy] = useState<'created_at' | 'post_created_at'>('created_at');
  const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('desc');

  const {
    items: posts,
    isLoading,
    isLoadingMore,
    error,
    hasMore,
    loadMore,
    retry,
    clearError,
  } = useDataLoader<Post>({
    loadFn: async (skip, limit) => {
      if (!isAuthenticated) {
        throw new Error('Authentication required');
      }
      const token = await getAccessTokenSilently();
      const fetchedPosts = await getSavedPosts(
        skip,
        limit,
        sortBy,
        sortOrder,
        token
      );
      return {
        items: fetchedPosts,
      };
    },
    pageSize: 20,
    autoLoad: true,
    requireAuth: true,
    retryConfig: {
      maxRetries: 3,
      retryDelay: 1000,
      autoRetry: true,
    },
  });

  // èªè¨¼ãƒã‚§ãƒƒã‚¯
  if (!isAuthenticated) {
    return (
      <div className="min-h-screen bg-gray-50 dark:bg-gray-900">
        <Header />
        <div className="container mx-auto px-4 py-8">
          <div className="text-center">
            <h1 className="text-2xl font-bold mb-4">{t('authenticationRequired')}</h1>
            <p className="text-gray-600 dark:text-gray-400">{t('pleaseLogin')}</p>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 dark:bg-gray-900">
      <Header />
      <div className="container mx-auto px-4 py-8">
        <div className="max-w-4xl mx-auto">
          {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
          <div className="mb-6">
            <h1 className="text-3xl font-bold mb-2">{t('pageTitle')}</h1>
            <p className="text-gray-600 dark:text-gray-400">{t('pageSubtitle')}</p>
          </div>

          {/* ã‚½ãƒ¼ãƒˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ */}
          <div className="mb-6 flex items-center space-x-4">
            <select
              value={sortBy}
              onChange={(e) => setSortBy(e.target.value as 'created_at' | 'post_created_at')}
              className="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800"
            >
              <option value="created_at">{t('sortBy.saveDate')}</option>
              <option value="post_created_at">{t('sortBy.postDate')}</option>
            </select>
            <select
              value={sortOrder}
              onChange={(e) => setSortOrder(e.target.value as 'asc' | 'desc')}
              className="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800"
            >
              <option value="desc">{t('sortOrder.newest')}</option>
              <option value="asc">{t('sortOrder.oldest')}</option>
            </select>
          </div>

          {/* ã‚¨ãƒ©ãƒ¼è¡¨ç¤º */}
          {error && (
            <div className="mb-6">
              <ErrorDisplay
                error={extractErrorInfo(error)}
                onRetry={retry}
                onDismiss={clearError}
              />
            </div>
          )}

          {/* æŠ•ç¨¿ä¸€è¦§ */}
          {isLoading && posts.length === 0 ? (
            <div className="text-center py-12">
              <div className="w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
              <p className="text-gray-600 dark:text-gray-400">{t('loading')}</p>
            </div>
          ) : posts.length === 0 ? (
            <div className="text-center py-12">
              <svg
                className="w-16 h-16 text-gray-400 mx-auto mb-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  strokeWidth={2}
                  d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"
                />
              </svg>
              <h2 className="text-xl font-semibold mb-2">{t('noSavedPosts')}</h2>
              <p className="text-gray-600 dark:text-gray-400">{t('noSavedPostsMessage')}</p>
            </div>
          ) : (
            <>
              <div className="space-y-4">
                {posts.map((post) => (
                  <PostCard
                    key={post.id}
                    post={post}
                    onPostDeleted={() => {
                      // å‰Šé™¤ã•ã‚ŒãŸæŠ•ç¨¿ã‚’ãƒªã‚¹ãƒˆã‹ã‚‰å‰Šé™¤
                      // useDataLoaderã®refreshã‚’å‘¼ã³å‡ºã™
                    }}
                  />
                ))}
              </div>

              {/* ã‚‚ã£ã¨è¦‹ã‚‹ãƒœã‚¿ãƒ³ */}
              {hasMore && (
                <div className="mt-6 text-center">
                  <button
                    onClick={loadMore}
                    disabled={isLoadingMore}
                    className="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"
                  >
                    {isLoadingMore ? t('loadingMore') : t('loadMore')}
                  </button>
                </div>
              )}
            </>
          )}
        </div>
      </div>
    </div>
  );
}
```

### 4. ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã¸ã®è¿½åŠ 

**ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/components/Header.tsx`

```typescript
// ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«è¿½åŠ 
<Link
  href="/posts/saved"
  className="text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400"
>
  {t('navigation.savedPosts')}
</Link>
```

---

## ğŸŒ å¤šè¨€èªå¯¾å¿œ

### ç¿»è¨³ã‚­ãƒ¼

**ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/messages/ja.json` ã¨ `frontend/messages/en.json`

```json
{
  "savedPosts": {
    "pageTitle": "ä¿å­˜ã—ãŸæŠ•ç¨¿",
    "pageSubtitle": "å¾Œã§èª­ã‚€ãŸã‚ã«ä¿å­˜ã—ãŸæŠ•ç¨¿ã‚’ç®¡ç†ã—ã¾ã™",
    "save": "ä¿å­˜",
    "unsave": "ä¿å­˜è§£é™¤",
    "saved": "æŠ•ç¨¿ã‚’ä¿å­˜ã—ã¾ã—ãŸ",
    "unsaved": "ä¿å­˜ã‚’è§£é™¤ã—ã¾ã—ãŸ",
    "saveFailed": "ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ",
    "loading": "èª­ã¿è¾¼ã¿ä¸­...",
    "loadingMore": "èª­ã¿è¾¼ã¿ä¸­...",
    "loadMore": "ã‚‚ã£ã¨è¦‹ã‚‹",
    "noSavedPosts": "ä¿å­˜ã—ãŸæŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“",
    "noSavedPostsMessage": "æ°—ã«ãªã‚‹æŠ•ç¨¿ã‚’è¦‹ã¤ã‘ãŸã‚‰ã€ä¿å­˜ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä¿å­˜ã§ãã¾ã™ã€‚",
    "sortBy": {
      "saveDate": "ä¿å­˜æ—¥æ™‚",
      "postDate": "æŠ•ç¨¿æ—¥æ™‚"
    },
    "sortOrder": {
      "newest": "æ–°ã—ã„é †",
      "oldest": "å¤ã„é †"
    },
    "authenticationRequired": "ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™",
    "pleaseLogin": "ä¿å­˜ã—ãŸæŠ•ç¨¿ã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯ã€ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚"
  },
  "navigation": {
    "savedPosts": "ä¿å­˜ã—ãŸæŠ•ç¨¿"
  },
  "post": {
    "saved": "ä¿å­˜æ¸ˆã¿",
    "save": "ä¿å­˜"
  }
}
```

**è‹±èªç‰ˆ** (`frontend/messages/en.json`):
```json
{
  "savedPosts": {
    "pageTitle": "Saved Posts",
    "pageSubtitle": "Manage posts you've saved for later reading",
    "save": "Save",
    "unsave": "Unsave",
    "saved": "Post saved",
    "unsaved": "Post unsaved",
    "saveFailed": "Failed to save post",
    "loading": "Loading...",
    "loadingMore": "Loading...",
    "loadMore": "Load More",
    "noSavedPosts": "No saved posts",
    "noSavedPostsMessage": "When you find interesting posts, click the save icon to save them.",
    "sortBy": {
      "saveDate": "Save Date",
      "postDate": "Post Date"
    },
    "sortOrder": {
      "newest": "Newest First",
      "oldest": "Oldest First"
    },
    "authenticationRequired": "Authentication Required",
    "pleaseLogin": "Please log in to view your saved posts."
  },
  "navigation": {
    "savedPosts": "Saved Posts"
  },
  "post": {
    "saved": "Saved",
    "save": "Save"
  }
}
```

---

## âœ… å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½œæˆ
- [ ] `SavedPost`ãƒ¢ãƒ‡ãƒ«ã®å®Ÿè£…
- [ ] `SavedPostService`ã®å®Ÿè£…
- [ ] APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å®Ÿè£…
- [ ] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ä½œæˆ
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆã®ä½œæˆ

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- [ ] APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆé–¢æ•°ã®å®Ÿè£…
- [ ] `PostCard`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¸ã®ä¿å­˜ã‚¢ã‚¤ã‚³ãƒ³è¿½åŠ ï¼ˆã‚¢ã‚¤ã‚³ãƒ³ã®ã¿ï¼‰
- [ ] ä¿å­˜ã—ãŸæŠ•ç¨¿ä¸€è¦§ãƒšãƒ¼ã‚¸ã®ä½œæˆ
- [ ] ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã¸ã®ãƒªãƒ³ã‚¯è¿½åŠ 
- [ ] ç¿»è¨³ã‚­ãƒ¼ã®è¿½åŠ ï¼ˆæ—¥æœ¬èªãƒ»è‹±èªï¼‰
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å®Ÿè£…
- [ ] ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®å®Ÿè£…
- [ ] ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ï¼ˆtitleå±æ€§ï¼‰ã®å®Ÿè£…
- [ ] ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å¯¾å¿œï¼ˆaria-labelï¼‰ã®å®Ÿè£…

### ãƒ†ã‚¹ãƒˆ
- [ ] ä¿å­˜/è§£é™¤æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ
- [ ] ä¿å­˜ã—ãŸæŠ•ç¨¿ä¸€è¦§ã®ãƒ†ã‚¹ãƒˆ
- [ ] ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ†ã‚¹ãƒˆ
- [ ] ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ
- [ ] èªè¨¼ãƒã‚§ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ
- [ ] å…¬é–‹ç¯„å›²ã«ã‚ˆã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã®ãƒ†ã‚¹ãƒˆ

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [ ] APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¬ã‚¤ãƒ‰ã®ä½œæˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

---

## ğŸš€ å®Ÿè£…é †åº

1. **Phase 1: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰åŸºç›¤** (1-2æ—¥)
   - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
   - ãƒ¢ãƒ‡ãƒ«ãƒ»ã‚¹ã‚­ãƒ¼ãƒã®å®Ÿè£…
   - ã‚µãƒ¼ãƒ“ã‚¹å±¤ã®å®Ÿè£…
   - åŸºæœ¬çš„ãªAPIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

2. **Phase 2: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰åŸºæœ¬æ©Ÿèƒ½** (1-2æ—¥)
   - APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®å®Ÿè£…
   - PostCardã¸ã®ä¿å­˜ã‚¢ã‚¤ã‚³ãƒ³è¿½åŠ ï¼ˆã‚¢ã‚¤ã‚³ãƒ³ã®ã¿ï¼‰
   - ä¿å­˜ã—ãŸæŠ•ç¨¿ä¸€è¦§ãƒšãƒ¼ã‚¸ã®ä½œæˆ

3. **Phase 3: æ©Ÿèƒ½æ‹¡å¼µ** (0.5-1æ—¥)
   - ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ”¹å–„
   - UI/UXã®æ”¹å–„

4. **Phase 4: ãƒ†ã‚¹ãƒˆãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ** (0.5æ—¥)
   - ãƒ†ã‚¹ãƒˆã®ä½œæˆ
   - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°

---

## ğŸ“ æ³¨æ„äº‹é …

1. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: å¤§é‡ã®ä¿å­˜ãŒã‚ã‚‹å ´åˆã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒé‡è¦
2. **å…¬é–‹ç¯„å›²**: ä¿å­˜ã—ãŸæŠ•ç¨¿ã§ã‚‚ã€å…ƒã®æŠ•ç¨¿ã®å…¬é–‹ç¯„å›²è¨­å®šã‚’å°Šé‡
3. **å‰Šé™¤ã•ã‚ŒãŸæŠ•ç¨¿**: æŠ•ç¨¿ãŒå‰Šé™¤ã•ã‚ŒãŸå ´åˆã€ä¿å­˜ã‚‚è‡ªå‹•çš„ã«å‰Šé™¤ï¼ˆCASCADEï¼‰
4. **é‡è¤‡é˜²æ­¢**: åŒã˜æŠ•ç¨¿ã‚’è¤‡æ•°å›ä¿å­˜ã§ããªã„ã‚ˆã†ã«ã™ã‚‹ï¼ˆUNIQUEåˆ¶ç´„ï¼‰

---

**æœ€çµ‚æ›´æ–°**: 2025-11-27

